# coding: utf-8
"""Waylay Function Registry api tests.

This code was generated from the OpenAPI documentation of 'Waylay Function Registry'

Generated by OpenAPI Generator (https://openapi-generator.tech)

Do not edit the class manually.
"""


import pytest
from pytest_httpx import HTTPXMock
import json
from waylay.sdk import ApiClient, WaylayClient
from waylay.services.registry.api import JobsApi
from waylay.services.registry.service import RegistryService


from ..types.event_with_close_sse_stub import EventWithCloseSSEStub
from waylay.services.registry.models import EventWithCloseSSE


from ..types.job_type_stub import JobTypeStub


from ..types.job_response_stub import JobResponseStub
from waylay.services.registry.models import JobResponse


from ..types.jobs_response_stub import JobsResponseStub
from waylay.services.registry.models import JobsResponse


# some mappings that are needed for some <example> interpolations
null, true, false = None, True, False


@pytest.fixture
def jobs_api(waylay_api_client: ApiClient) -> JobsApi:
    return JobsApi(waylay_api_client)


def test_registered(waylay_client: WaylayClient):
    """Test that JobsApi api is registered in the sdk client."""
    assert isinstance(waylay_client.registry.jobs, JobsApi)


@pytest.mark.asyncio
async def test_events(
    service: RegistryService, gateway_url: str, httpx_mock: HTTPXMock
):
    """Test case for events
    Stream Events
    """
    # set path params

    mock_response = EventWithCloseSSEStub.create_instance().to_dict()
    httpx_mock_kwargs = {
        "method": "GET",
        "url": gateway_url + f"/registry/v2/jobs/events",  # noqa: F541
        "content": json.dumps(mock_response, default=str),
        "status_code": 200,
    }
    httpx_mock.add_response(**httpx_mock_kwargs)
    kwargs = {}
    resp = await service.jobs.events(**kwargs)
    assert isinstance(resp, EventWithCloseSSE)


@pytest.mark.asyncio
async def test_get(service: RegistryService, gateway_url: str, httpx_mock: HTTPXMock):
    """Test case for get
    Get Job
    """
    # set path params
    type = JobTypeStub.create_instance().value

    id = "id_example"

    mock_response = JobResponseStub.create_instance().to_dict()
    httpx_mock_kwargs = {
        "method": "GET",
        "url": gateway_url + f"/registry/v2/jobs/{type}/{id}",  # noqa: F541
        "content": json.dumps(mock_response, default=str),
        "status_code": 200,
    }
    httpx_mock.add_response(**httpx_mock_kwargs)
    kwargs = {
        "type": type,
        "id": id,
    }
    resp = await service.jobs.get(**kwargs)
    assert isinstance(resp, JobResponse)


@pytest.mark.asyncio
async def test_list(service: RegistryService, gateway_url: str, httpx_mock: HTTPXMock):
    """Test case for list
    List Jobs
    """
    # set path params

    mock_response = JobsResponseStub.create_instance().to_dict()
    httpx_mock_kwargs = {
        "method": "GET",
        "url": gateway_url + f"/registry/v2/jobs/",  # noqa: F541
        "content": json.dumps(mock_response, default=str),
        "status_code": 200,
    }
    httpx_mock.add_response(**httpx_mock_kwargs)
    kwargs = {}
    resp = await service.jobs.list(**kwargs)
    assert isinstance(resp, JobsResponse)
